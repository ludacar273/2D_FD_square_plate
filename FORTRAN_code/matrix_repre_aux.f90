SUBROUTINE matrix_repre_aux(n,nangular,k, B )!matriz con condicion de dirichlet solamente en los bordes.
   INTEGER, INTENT(IN) :: n, nangular, k
   DOUBLE PRECISION, INTENT(OUT) :: B(n,n)  !matriz auxiliar
   DOUBLE PRECISION :: hr, ri
   INTEGER :: r, var

   call inicializarmatriz(1, n, n, B)!llenado de la matriz B (matriz auxiliar), dimension (n*n), de puros ceros. revisar subrutina 'inicializarmatriz'.

   hr= 1.0/(dble(n) + 1.0)	!paso radial
   
!!!!!!!!!!!!!!!!!!!!!!!!Si cambias el valor de hr, cambia el valor de r en la molecula, ten cuidado
!Molecula interna (completa) matriz dentro de dos marcos, como de cuadros, de datos. 

!r1        !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 i = 1
 ri=hr*i
 B(i,i+2) = 1.0/(hr**4) + 1.0/(2*ri*(hr**3))
 B(i,i+1) = - 4.0/(hr**4) - 1.0/(ri*(hr**3)) - (1.0+2*(k**2))/((ri**2)*(hr**2)) + (1.0+2*(k**2))/(2*(ri**3)*hr)
 B(i,i) = 6.0/(hr**4) + (2.0 + 4*(k**2))/((ri**2)*(hr**2)) + (k**4 - 4*(k**2))/(ri**4)
 !B(i,i-1) = - 4.0/(hr**4) + 1.0/(ri*(hr**3)) - (1.0+2*(k**2))/((ri**2)*(hr**2)) - (1.0+2*(k**2))/(2*(ri**3)*hr)
 !B(i,i-2) = 1.0/(hr**4) - 1.0/(2*ri*(hr**3))

 B(i,i) = B(i,i) + 1.0/(hr**4) - 1.0/(2*ri*(hr**3)) + (- 4.0/(hr**4) + 1.0/(ri*(hr**3)))*alpa(k, nangular)/nangular &  
          & +(-(1.0+2*(k**2))/((ri**2)*(hr**2))-(1.0+2*(k**2))/(2*(ri**3)*hr))*alpa(k, nangular)/nangular   
print*, alpa(k, nangular)/nangular 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
!r2        !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 i = 2
 ri=hr*i
 B(i,i+2) = 1.0/(hr**4) + 1.0/(2*ri*(hr**3))
 B(i,i+1) = - 4.0/(hr**4) - 1.0/(ri*(hr**3)) - (1.0+2*(k**2))/((ri**2)*(hr**2)) + (1.0+2*(k**2))/(2*(ri**3)*hr)
 B(i,i) = 6.0/(hr**4) + (2.0 + 4*(k**2))/((ri**2)*(hr**2)) + (k**4 - 4*(k**2))/(ri**4)
 B(i,i-1) = - 4.0/(hr**4) + 1.0/(ri*(hr**3)) - (1.0+2*(k**2))/((ri**2)*(hr**2)) - (1.0+2*(k**2))/(2*(ri**3)*hr)
 !B(i,i-2) = 1.0/(hr**4) - 1.0/(2*ri*(hr**3))

 B(i,i-1) = B(i,i-1) + (1.0/(hr**4) - 1.0/(2*ri*(hr**3)) )*alpa(k,nangular)/nangular 

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
!r3        !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

 i = n-1
 ri=hr*i
 !B(i,i+2) = 1.0/(hr**4) + 1.0/(2*ri*(hr**3))
 B(i,i+1) = - 4.0/(hr**4) - 1.0/(ri*(hr**3)) - (1.0+2*(k**2))/((ri**2)*(hr**2)) + (1.0+2*(k**2))/(2*(ri**3)*hr)
 B(i,i) = 6.0/(hr**4) + (2.0 + 4*(k**2))/((ri**2)*(hr**2)) + (k**4 - 4*(k**2))/(ri**4)
 B(i,i-1) = - 4.0/(hr**4) + 1.0/(ri*(hr**3)) - (1.0+2*(k**2))/((ri**2)*(hr**2)) - (1.0+2*(k**2))/(2*(ri**3)*hr)
 B(i,i-2) = 1.0/(hr**4) - 1.0/(2*ri*(hr**3))

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
!r4        !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

 i = n
 ri=hr*i
 !B(i,i+2) = 1.0/(hr**4) + 1.0/(2*ri*(hr**3))
 !B(i,i+1) = - 4.0/(hr**4) - 1.0/(ri*(hr**3)) - (1.0+2*(k**2))/((ri**2)*(hr**2)) + (1.0+2*(k**2))/(2*(ri**3)*hr)
 B(i,i) = 6.0/(hr**4) + (2.0 + 4*(k**2))/((ri**2)*(hr**2)) + (k**4 - 4*(k**2))/(ri**4)
 B(i,i-1) = - 4.0/(hr**4) + 1.0/(ri*(hr**3)) - (1.0+2*(k**2))/((ri**2)*(hr**2)) - (1.0+2*(k**2))/(2*(ri**3)*hr)
 B(i,i-2) = 1.0/(hr**4) - 1.0/(2*ri*(hr**3))

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
!r2        !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

do i = 3, n-2
    ri=hr*i
    B(i,i+2) = 1.0/(hr**4) + 1.0/(2*ri*(hr**3))
    B(i,i+1) = - 4.0/(hr**4) - 1.0/(ri*(hr**3)) - (1.0+2*(k**2))/((ri**2)*(hr**2)) + (1.0+2*(k**2))/(2*(ri**3)*hr)
    B(i,i) = 6.0/(hr**4) + (2.0 + 4*(k**2))/((ri**2)*(hr**2)) + (k**4 - 4*(k**2))/(ri**4)
    B(i,i-1) = - 4.0/(hr**4) + 1.0/(ri*(hr**3)) - (1.0+2*(k**2))/((ri**2)*(hr**2)) - (1.0+2*(k**2))/(2*(ri**3)*hr)
    B(i,i-2) = 1.0/(hr**4) - 1.0/(2*ri*(hr**3))
end do


!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

  contains
  DOUBLE PRECISION  FUNCTION alpa(argk,arg_nang)
     integer :: argk,arg_nang
     
     if (mod(argk, arg_nang) .EQ. 0.0 )then 
       alpa = arg_nang
     else 
       alpa = 0.0 
     end if
  end function
     
END SUBROUTINE matrix_repre_aux
